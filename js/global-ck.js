//App Functions
function toggleForm(e){console.log("toggleForm",e);var t=$("#login"),n=$(t);if(e!="login")n.fadeIn();else{n.fadeOut();switchState("log out")}}function authenticate(){var e="",t=$("input#username").val(),n=$("input#password").val();switch(t){case"root":e=0;break;case"admin":e=1;break;case"manager":e=2;break;case"user":e=3}if(t in USERS)if(USERS[t].role==e){CONFIG.user.username=t;CONFIG.user.role=e;switchState("login")}else error();else switchState("log out")}function login(){clearErrors();$("#login").fadeOut("fast",function(){$("#survey1.chart","#questions").css("visibility","visible").show();executePriveleges(CONFIG.user.username);CONFIG.user.status="login"})}function logout(){var e=$($("#questions, .priveleged"));$(".chart","#questions").css("visibility","hidden");e.removeAttr("style").fadeOut("fast",function(){$("#login").fadeIn("fast",function(){CONFIG.user.status="";CONFIG.user.password="";CONFIG.user.username=""})})}function switchState(e){var t=$("#loginoutbtn a");$(t).toggleClass("loggedin");switch(e){case"login":var n="log out";$(t).text(n);login();break;case"log out":var n="login";$(t).text(n);logout()}}function error(){console.log("error");$(".error").fadeIn()}function clearErrors(){$(".error").fadeOut()}function grabOption(e){$that=e;var t=$that.text(),n=$("select option:contains("+t+")","#survey_selection").attr("value");return n}function executePriveleges(e){var t="",n="",r="",i={access:[".priveleged","#questions"],context:["#sidebar","#body .inner"]},s={access:[".priveleged","#questions"],context:["#sidebar","#body .inner"]},o={access:["#questions","#questions .priveleged"],context:["#sidebar","#body .inner"]},u={access:["#questions","#questions .priveleged"],context:["#sidebar","#body .inner"]};switch(e){case"root":t=i;break;case"admin":t=s;break;case"manager":t=o;break;case"user":t=u}$.each(t,function(e,t){if(e=="access"){console.log("selector is: ",t);n+=t}else{console.log("context is: ",t);r+=t}});console.log(n,r);$(n,r).fadeIn()}function toggleChart(e){console.log("toggling chart",e);var t=$("#questions .chart, .priveleged","#body");$(t).removeAttr("style").css("width","100%").fadeOut("fast",function(){var t=$("#questions .question, #questions > div");$(t).css("visibility","");console.log($(e,e+"> div","#questions"));$(e).css("visibility","visible").fadeIn()})}function generateReports(e){console.log("generating reports")}function listUsers(e){var t='<form action="" method="post" id="list_users">';t+='<table width="100%" cellpadding="0" border="0" id="users">';var n=0;console.log(USERS);for(key in USERS){row="<tr class='user-"+USERS[key].name;n%2==0?row+=" even":row+=" odd";row+="'>";row+='<td><input type="checkbox" name="'+USERS[key].name+'"></td>';row+="<td>"+USERS[key].name+"</td>";row+="<td>"+key+"</td>";row+="<td>"+USERS[key].email+"</td>";row+="<td>"+USERS[key].active+"</td>";row+="</tr>";t+=row;n++}t+='</table><ul id="user_controls">';t+='<li id="update"><input type="submit" name="update" value="update"></li>';t+='<li id="deactivate"><input type="submit" name="deactivate" value="deactivate"></li>';t+='<li id="delete"><input type="submit" name="delete" value="delete"></li>';t+="</ul></form>";$(e).html(t)}function toggleContent(e){switch(e){case"#all_users":listUsers(e);break;case"#raw_question_data":generateReports(e)}$("#body .inner > div:visible").fadeOut("fast",function(){$(e,"#body .inner").css("visibility","visible").fadeIn("fast")})}function striper(e,t){var n="",r="";switch(typeof e){case"table":n="td";r="tr";break;case"ul":n="li";r="ul"}if(r=="ul"){$(n+":first").addClass("first");$(n+":last").addClass("last")}else if(r=="tr"){$(r+":first").addClass("first");$(r+":last").addClass("last")}$(n+":odd").after(t).addClass("odd")}function renderCharts(){console.log("rendering charts");if($(".chart").length>0){var e=["chart1","chart2","chart3","chart4","chart5","chart6","chart7","chart8","chart9","chart10","chart11","chart12"];for(var t=0;t<e.length;t++){console.log("#"+e[t],"<p>"+data[e[t]].questionData.name+"</p>");window.chart=e[t];chart=new Highcharts.Chart(data[chart]);$("#"+e[t]).before().prepend("<p>"+data[e[t]].questionData.name+"</p>")}processTable(data)}}function processTable(e){for(node in e)renderTable(data[node],data[node].questionData)}function renderTable(e,t){var n="",r="",s='<table width="100%" cellpadding="0" cellspacing="0" class="'+e.chart.renderTo+' stripes">',o='<tr class="question_title"><td>'+t.name+"</td></tr>",u='<tr class="headings"><td>Answer Options</td><td>Response Percent</td><td>Response</td></tr>';for(i=0;i<t.choices.length;i++){console.log(t.name);r+='<tr class="response"><td>'+t.choices[i]+"</td>"+"<td>"+16.7+"%</td>"+"<td>"+1+"</td></tr>"}n+=s+o+u+r+"</table>";$("#"+e.chart.renderTo).after().append(n)}$("document").ready(function(){renderCharts();$("#questions .chart, #all_users, #raw_question_data","#body .inner").css("visibility","hidden");$("#questions").hide().css("visibility","visible");$("#stats li:first","#sidebar").addClass("first");$("#stats li:last","#sidebar").addClass("last");$("form.jqtransform","#sidebar").length>0&&$("form.jqtransform","#sidebar").jqTransform();$(".priveleged","#sidebar, #header, #body .inner").hide();$("#loginout","#header").length>0&&$("#loginout a").on("click",function(e){e.preventDefault();toggleForm(CONFIG.user.status)});$('#login input[type="submit"]').on("click",function(e){e.preventDefault();authenticate()});$(".jqTransformSelectWrapper ul li a").click(function(){var e=grabOption($(this));toggleChart(e)});$("#stats a, #admin_controls a","#sidebar .priveleged").on("click",function(e){e.preventDefault();var t="#"+$(this).attr("href");toggleContent(t)})});